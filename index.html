<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Museum AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      html, body, a-scene {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        position: fixed;
        top: 0;
        left: 0;
      }

      #loading {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: #000;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-size: 1.2rem;
      }

      .fullscreen-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 10000;
        padding: 6px 12px;
        font-size: 14px;
        background: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="loading">Sobar jap AR nak bukak dah...</div>
    <button id="fullscreenBtn" class="fullscreen-btn">Fullscreen</button>

    <a-scene
      mindar-image="imageTargetSrc: ./guaPelangi.mind"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      embedded
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <video id="video1" src="./Batukapur.mp4" playsinline preload="auto" crossorigin="anonymous" style="display: none"></video>
        <video id="video2" src="./Tapakkajian.mp4" playsinline preload="auto" crossorigin="anonymous" style="display: none"></video>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Marker 1 -->
      <a-entity id="marker1" mindar-image-target="targetIndex: 0">
        <a-video id="ar-video1" src="#video1" width="1" height="0.6" position="0 0 0"></a-video>
        <a-text value="Label: Artifact A" position="0 -0.5 0" width="2" align="center" color="white"></a-text>
        <a-image id="pinBtn1" src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png" position="0.5 -0.4 0" width="0.15" height="0.15" class="clickable"></a-image>
      </a-entity>

      <!-- Marker 2 -->
      <a-entity id="marker2" mindar-image-target="targetIndex: 1">
        <a-video id="ar-video2" src="#video2" width="1" height="0.6" position="0 0 0"></a-video>
        <a-text value="Label: Artifact B" position="0 -0.5 0" width="2" align="center" color="white"></a-text>
        <a-image id="pinBtn2" src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png" position="0.5 -0.4 0" width="0.15" height="0.15" class="clickable"></a-image>
      </a-entity>
    </a-scene>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const video1 = document.getElementById("video1");
        const video2 = document.getElementById("video2");
        const marker1 = document.getElementById("marker1");
        const marker2 = document.getElementById("marker2");
        const fullscreenBtn = document.getElementById("fullscreenBtn");
        const pinBtn1 = document.getElementById("pinBtn1");
        const pinBtn2 = document.getElementById("pinBtn2");

        let pinned1 = false;
        let pinned2 = false;

        marker1.addEventListener("targetFound", () => {
          if (!pinned1) {
            video1.muted = false;
            video1.play().catch(() => {});
          }
        });

        marker1.addEventListener("targetLost", () => {
          if (!pinned1) {
            video1.pause();
            video1.currentTime = 0;
          }
        });

        marker2.addEventListener("targetFound", () => {
          if (!pinned2) {
            video2.muted = false;
            video2.play().catch(() => {});
          }
        });

        marker2.addEventListener("targetLost", () => {
          if (!pinned2) {
            video2.pause();
            video2.currentTime = 0;
          }
        });

        // Pin buttons
        pinBtn1.addEventListener("click", () => {
          pinned1 = !pinned1;
          alert(pinned1 ? "Pinned Video 1" : "Unpinned Video 1");
        });

        pinBtn2.addEventListener("click", () => {
          pinned2 = !pinned2;
          alert(pinned2 ? "Pinned Video 2" : "Unpinned Video 2");
        });

        // Fullscreen
        fullscreenBtn.addEventListener("click", () => {
          const v = video1.paused ? video2 : video1;
          if (v.requestFullscreen) {
            v.requestFullscreen();
          } else if (v.webkitRequestFullscreen) {
            v.webkitRequestFullscreen();
          } else if (v.msRequestFullscreen) {
            v.msRequestFullscreen();
          }
        });

        // Unlock iOS autoplay
        document.body.addEventListener("click", () => {
          video1.play().catch(() => {});
          video2.play().catch(() => {});
          video1.pause();
          video2.pause();
        });

        setTimeout(() => document.getElementById('loading').style.display = 'none', 5000);
      });
    </script>
  </body>
</html>